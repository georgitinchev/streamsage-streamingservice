@page
@model StreamSageWAD.Pages.SettingsModel
@{
    Layout = "_Layout";
}

<div class="container mt-5 centered-form">
    <div class="form-container">
        <h2 class="mb-4">Update Your Credentials</h2>

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                @TempData["ErrorMessage"]
            </div>
        }
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }

        <!-- Update PFP Picture Form -->
        <form method="post" asp-page-handler="UploadProfilePictureAsync" enctype="multipart/form-data">
            <div class="form-group mt-4">
                <label for="profilePicture">Profile Picture</label>
                @if (Model.UserDetailsModel?.ProfilePicture != null && Model.UserDetailsModel.ProfilePicture.Length > 0)
                {
                    <img style="width: 100px; height: 100px; margin-bottom: 20px" src="@($"data:image/png;base64,{Convert.ToBase64String(Model.UserDetailsModel.ProfilePicture)}")" alt="Profile Picture" />
                }
                else
                {
                    <img style="width: 100px; height: 100px; margin-bottom: 20px" src="/img/placeholder_pfp.jpg" alt="Profile Picture" />
                }
                <input id="profilePicture" class="form-control" type="file" asp-for="ProfilePictureModel.ProfilePicture" />
            </div>
            <div class="center-button">
                <button type="submit" class="btn btn-primary">Upload Picture</button>
            </div>
        </form>

        <!-- Update User Details Form -->
        <form method="post" asp-page-handler="UpdateUserDetails">
            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="form-group">
                <label for="username">Username</label>
                <input id="username" class="form-control" type="text" asp-for="UserDetailsModel.Username" />
                <span asp-validation-for="UserDetailsModel.Username" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input id="email" class="form-control" type="email" asp-for="UserDetailsModel.Email" />
                <span asp-validation-for="UserDetailsModel.Email" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label for="firstName">First Name</label>
                <input id="firstName" class="form-control" type="text" asp-for="UserDetailsModel.FirstName" />
                <span asp-validation-for="UserDetailsModel.FirstName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label for="lastName">Last Name</label>
                <input id="lastName" class="form-control" type="text" asp-for="UserDetailsModel.LastName" />
                <span asp-validation-for="UserDetailsModel.LastName" class="text-danger"></span>
            </div>
            <div class="center-button">
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>

        <!-- Change PWD form -->
        <form method="post" asp-page-handler="ChangePassword">
            <div class="form-group mt-4">
                <label for="password">Password</label>
                <input id="password" class="form-control" type="password" asp-for="ChangePasswordModel.Password" />
                <span asp-validation-for="ChangePasswordModel.Password" class="text-danger"></span>
            </div>
            <div class="center-button">
                <button type="submit" class="btn btn-primary">Change Password</button>
            </div>
        </form>
    </div>
</div>
